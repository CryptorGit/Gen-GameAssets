# Meta Segment Anything Playground  
## 「Create 3D Scenes」機能仕様（3Dモデル書き出しまで）

---

## 1. 概要

- 機能名: **Create 3D Scenes**
- 目的:
  - 1枚の画像から、ユーザーが指定した領域をセグメンテーションし、
    その領域ごとに **SAM 3D Objects / SAM 3D Body** を用いて 3Dモデルを生成する。
  - 1枚の画像から **複数オブジェクト** を選択し、同一シーン内に 3Dオブジェクトとして配置できる。
- 入出力:
  - 入力: 静止画（一般的なRGB画像）
  - 出力: 3Dシーン内の 3Dオブジェクト群  
    （Meta公式UIでは内部的には Gaussian Splatting ベースの PLY モデル）

---

## 2. 画面構成（Create 3D Scenes ビュー）

### 2.1 全体レイアウト

- **上部バー**
  - プロダクト名・モード名表示（Segment Anything / Create 3D Scenes）
  - グローバルメニュー（他デモへの切り替えなど）

- **左側パネル: 画像 & マスク編集キャンバス**
  - アップロードした画像（またはサンプル画像）が表示される。
  - ユーザーのクリック操作に応じて、セグメンテーションマスクがオーバーレイされる。
  - マスク編集モード（Add / Remove）の切り替えが可能。

- **右側パネル: 3Dビュー & オブジェクト一覧**
  - 選択済みオブジェクトの 3Dモデルを表示する 3Dビューワ。
  - シーンに含まれるオブジェクトのリスト（名称・サムネイル）を表示。
  - オブジェクト単位での選択・位置/回転の調整 UI。

- **下部バー**
  - `Generate 3D` ボタン（現在のマスクから 3D生成を実行）。
  - （場合により）現在のマスク編集対象オブジェクト名の表示。

---

## 3. 画像入力関連の機能

### 3.1 画像入力元

- **Upload ボタン**
  - ローカルファイルシステムから画像ファイルを選択してアップロード。
- **サンプルイメージ選択**
  - Metaが用意したサンプル画像一覧から1つを選択し、そのままマスク編集画面へ遷移。

### 3.2 画像の取り扱い

- アップロード完了後、自動的に **マスク編集モード** に遷移。
- キャンバス上に画像がフィットするように自動スケーリング。
- 内部的にはオリジナル解像度を保持しつつ、表示用に縮小・拡大を行う。

---

## 4. マスク編集（セグメンテーション）機能

### 4.1 クリックによる自動セグメンテーション

- ユーザーは、画像上で **対象オブジェクトの上をクリック** する。
- クリック位置を基準として、SAM 3（2D版）のセグメンテーション機能が動作し、
  該当するオブジェクト領域を自動推定してマスクとして表示する。
- 1つのオブジェクトに対して複数点を打つことで、マスクを拡張／精密化できる。

### 4.2 Add / Remove によるマスク調整

- **モード切替**
  - `Add` モード:
    - クリック位置を「追加ポイント」として扱い、マスクを広げる。
  - `Remove` モード:
    - クリック位置を「除外ポイント」として扱い、マスクからその領域を削る。
- これにより、はみ出し部分や取り残し部分を直感的に修正可能。

### 4.3 マスク表示

- 現在編集中のマスクは、元画像の上に半透明カラーでオーバーレイ表示。
- 複数マスクが存在する場合でも、
  現在編集しているマスクが強調表示される。

---

## 5. オブジェクト管理機能

### 5.1 オブジェクト追加

- `Add Object +`（または `Add Objects`）ボタン:
  - 現在のマスク編集が1つのオブジェクトとして確定される。
  - オブジェクト一覧に新規エントリが追加される。
  - その後、再び画像上で別の領域をクリックし、 **次のオブジェクト用マスク編集** に入る。

### 5.2 オブジェクトごとのマスク管理

- 各オブジェクトは
  - 画像上の 2Dマスク
  - 生成された 3Dモデル
  をセットとして保持する。
- オブジェクト一覧から特定のオブジェクトを選択すると、
  - そのオブジェクトのマスクが再度編集対象としてアクティブになる（場合がある）。
  - または 3Dビュー側でそのオブジェクトにフォーカスされる。

### 5.3 オブジェクトの編集・削除

- **マスク再編集**
  - 対象オブジェクトを選択し、再度 Add / Remove でマスクを修正。
  - 再度 `Generate 3D` を行うと、該当オブジェクトの 3Dモデルが更新される。
- **オブジェクト削除**
  - オブジェクト一覧から削除操作（「Remove」ボタン等）を行うことで、
    そのオブジェクトのマスクと 3Dモデルがシーンから除外される。

---

## 6. 3D生成・プレビュー機能

### 6.1 Generate 3D

- `Generate 3D` ボタンを押すと、現在アクティブなマスクに対して 3D生成を実行。
- 内部的な処理の流れ（概念レベル）:
  1. アップロード画像とマスクを切り出し or マスク情報付きで SAM 3D Objects / Body に入力。
  2. 単眼画像から対象オブジェクトの 3D形状・テクスチャ・レイアウト（シーン内位置）を推論。
  3. Gaussian Splatting ベースの 3D表現（点群 + テクスチャ）として 3Dモデルを構築。
- 複数オブジェクトがある場合、
  - 各オブジェクトごとに 3D生成が **並行して** 進む。

### 6.2 3Dビュー（プレビュー）

- 右側パネルに 3Dビューが表示される。
- 主な操作:
  - ドラッグで視点回転（オービット）
  - ホイール or ピンチでズームイン / ズームアウト
  - 右ドラッグ（または専用操作）でパン
- 役割:
  - 生成された 3Dモデルの形状・補完具合・テクスチャ・影のベイク状況などを
    目視で確認する。

### 6.3 シーン内のオブジェクト配置調整

- 各オブジェクトは 3D空間内で
  - **位置（平行移動）**
  - **回転**
  - （場合によってはスケール）
  を個別に調整可能。
- UI上の典型的な挙動:
  - オブジェクト一覧から対象オブジェクトを選択。
  - 3Dビュー内にギズモ（移動・回転ハンドル）が表示される。
  - またはプロパティパネルで数値指定（Position, Rotation 等）。
- 用途:
  - もとの2D画像では手前・奥に重なっていたオブジェクトを、
    3Dシーン上で少しずつ位置をずらして見やすく配置する。
  - 同一画像から生成された複数オブジェクトを「シーン」として再構成する。

---

## 7. 3Dモデル書き出し機能（効果・動画抜きの整理）

> ※ Meta公式UIでは、3Dモデルダウンロードへの導線が  
>  「Add effects → Share → 3D Model」タブ経由になっている。  
>  ここでは **3Dモデル書き出しに必要な部分だけ** を抜粋する。

### 7.1 Share 画面での 3D Model タブ

- 3Dシーンの生成が完了した状態で
  - 上部 or 右上にある `Share`（共有）操作を実行すると、
    シェア用のモーダル / ページが開く。
- この画面には複数のタブが存在し、そのひとつが **`3D Model` タブ**。
  - 他のタブ（動画プレビュー、エフェクト付き動画など）は今回は無視してよい。

### 7.2 Download 3D Model

- `3D Model` タブ内に **`Download 3D Model`** ボタンが存在する。
- これをクリックすると、
  - 現在の 3Dシーン or 選択オブジェクトに対応する 3Dモデルファイルがダウンロードされる。
  - ファイル形式は **PLY（Gaussian Splatting形式）**。
- ダウンロード対象:
  - 実際の挙動としては、
    - シーン全体の PLY（複数オブジェクトを含む）
    - あるいはオブジェクトごとの PLY
    のどちらかが提供される（UI上はシーン単位での書き出しに見える）。

---

## 8. 再実装のための最小機能まとめ

あなたが自前で Web UI を再現する場合、  
最低限必要になるのは以下の機能群です。

1. **画像入力**
   - Upload ボタン
   - サンプル画像選択（任意）

2. **マスク編集**
   - クリックによる自動セグメンテーション（SAM 3）
   - Add / Remove 切り替えによるマスク修正
   - マスクのオーバーレイ表示

3. **オブジェクト管理**
   - Add Object（マスク確定 → オブジェクト登録）
   - オブジェクト一覧
   - オブジェクト削除 / 再編集

4. **3D生成**
   - Generate 3D（マスクから SAM 3D Objects / Body を叩く）
   - 生成結果を 3Dビューで表示

5. **シーン編集**
   - 3Dビューでの視点操作（回転 / ズーム / パン）
   - オブジェクトごとの位置・回転の調整

6. **3Dモデル書き出し**
   - 「現在のシーンを PLY 形式で Download」ボタン  
     （Meta公式の Add effects / Share 経由は省略し、  
      直接バックエンドから生成済み PLY を返す設計でよい）

以上を実装すれば、Meta AI Demos の **Create 3D Scenes** が  
「3Dモデルを書き出す」までに提供している中核機能はカバーできます。
